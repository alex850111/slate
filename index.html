
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;,&quot;javascript&quot;,&quot;python&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="javascript">javascript</a>
              <a href="#" data-language-name="python">python</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#get-authentication-key" class="toc-h1 toc-link" data-title="Get Authentication Key">Get Authentication Key</a>
          </li>
          <li>
            <a href="#server-integration" class="toc-h1 toc-link" data-title="Server Integration">Server Integration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#order-api" class="toc-h2 toc-link" data-title="Order API">Order API</a>
                  </li>
                  <li>
                    <a href="#validation-api" class="toc-h2 toc-link" data-title="Validation API">Validation API</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#pixel-implement" class="toc-h1 toc-link" data-title="Pixel Implement">Pixel Implement</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#referral-handle" class="toc-h2 toc-link" data-title="Referral Handle">Referral Handle</a>
                  </li>
                  <li>
                    <a href="#conversion-handle" class="toc-h2 toc-link" data-title="Conversion Handle">Conversion Handle</a>
                  </li>
              </ul>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1><h1 id='get-authentication-key'>Get Authentication Key</h1>

<p>API will be enable by submitting the <a href="https://docs.google.com/forms/d/e/1FAIpQLSc9dI5i9I5sSHyLpQt4afCVRHFbVnA5etj56dPTv31ep1LUdQ/viewform?usp=sf_link" target="_blank">form</a> to get ids and authentication key for further usage.</p>

<h1 id='server-integration'>Server Integration</h1>

<h2 id='order-api'>Order API</h2>

<blockquote>
<p>step 1 </p>

<p>user click from shopback and get redirected to merchant site with parameters that set by above submitting.</p>
</blockquote>

<pre class="highlight shell tab-shell"><code><span class="s2">"https://www.example.com/?test_ref=shopback&amp;sbid=1024207abb8d1b675f59803211155f"</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="s2">"https://www.example.com/?test_ref=shopback&amp;sbid=1024207abb8d1b675f59803211155f"</span>
</code></pre><pre class="highlight python tab-python"><code><span class="s">"https://www.example.com/?test_ref=shopback&amp;sbid=1024207abb8d1b675f59803211155f"</span>
</code></pre>

<p>This API is used for order data postback. Once the purchase is done and API get called, ShopBack will receive the data and keep it in system for further validation.</p>

<aside class="notice">Note that every product id could only appears once in an order.</br> 
If there are more than one of a unique product, please sum their price. </aside>

<h3 id='https-request-of-order-api'>HTTPS Request Of Order API</h3>

<p><code>GET https://shopback.go2cloud.org/aff_lsr</code></p>

<blockquote>
<p>step 2 </p>
</blockquote>

<pre class="highlight shell tab-shell"><code><span class="c">#item-1</span>
curl -X GET <span class="s2">"https://shopback.go2cloud.org/aff_c"</span><span class="se">\</span>
-d <span class="o">{</span><span class="s2">"offer_id"</span>:<span class="s2">"2118"</span>,<span class="se">\</span>
    <span class="s2">"adv_sub"</span>:<span class="s2">"A0149"</span>,<span class="se">\</span>
    <span class="s2">"amount"</span>:70,<span class="se">\</span>
    <span class="s2">"transaction_id"</span>:<span class="s2">"10267617e7919a09a12"</span>,<span class="se">\</span>
    <span class="s2">"security_token"</span>:<span class="s2">"c2a32524880"</span><span class="o">}</span>

<span class="c">#item-2</span>
curl -X GET <span class="s2">"https://shopback.go2cloud.org/aff_c"</span><span class="se">\</span>
-d <span class="o">{</span><span class="s2">"offer_id"</span>:<span class="s2">"2118"</span>,<span class="se">\</span>
    <span class="s2">"adv_sub"</span>:<span class="s2">"A0188"</span>,<span class="se">\</span>
    <span class="s2">"amount"</span>:130,<span class="se">\</span>
    <span class="s2">"transaction_id"</span>:<span class="s2">"10267617e7919a09a12"</span>,<span class="se">\</span>
    <span class="s2">"security_token"</span>:<span class="s2">"c2a32524880"</span><span class="o">}</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// item-1</span>
<span class="kd">var</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"adv_sub"</span><span class="p">:</span><span class="s2">"A0149"</span><span class="p">,</span> <span class="s2">"amount"</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span>
        <span class="s2">"transaction_id"</span><span class="p">:</span><span class="s2">"10267617e7919a09a12"</span><span class="p">,</span>
        <span class="s2">"security_token"</span><span class="p">:</span><span class="s2">"c2a32524880"</span><span class="p">};</span>
<span class="c1">// item-2</span>
<span class="kd">var</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"adv_sub"</span><span class="p">:</span><span class="s2">"A0188"</span><span class="p">,</span> <span class="s2">"amount"</span><span class="p">:</span><span class="mi">130</span><span class="p">,</span>
        <span class="s2">"transaction_id"</span><span class="p">:</span><span class="s2">"10267617e7919a09a12"</span><span class="p">,</span>
        <span class="s2">"security_token"</span><span class="p">:</span><span class="s2">"c2a32524880"</span><span class="p">};</span>
<span class="c1">// send request</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="s2">"https://shopback.go2cloud.org/aff_c?offer_id=2118"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">keys</span><span class="p">)</span>
    <span class="nx">src</span> <span class="o">+=</span> <span class="s1">'&amp;'</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'='</span> <span class="o">+</span> <span class="nx">param</span><span class="p">[</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
<span class="nx">requests</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">requests</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
</code></pre><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="c"># item-1</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"offer_id"</span><span class="p">:</span><span class="s">"2118"</span><span class="p">,</span> <span class="s">"adv_sub"</span><span class="p">:</span><span class="s">"A0149"</span><span class="p">,</span> <span class="s">"amount"</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span>
    <span class="s">"transaction_id"</span><span class="p">:</span><span class="s">"10267617e7919a09a12"</span><span class="p">,</span>
    <span class="s">"security_token"</span><span class="p">:</span><span class="s">"c2a32524880"</span>
<span class="p">}</span>
<span class="c"># item-2</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"offer_id"</span><span class="p">:</span><span class="s">"2118"</span><span class="p">,</span> <span class="s">"adv_sub"</span><span class="p">:</span><span class="s">"A0188"</span><span class="p">,</span> <span class="s">"amount"</span><span class="p">:</span><span class="mi">130</span><span class="p">,</span>
    <span class="s">"transaction_id"</span><span class="p">:</span><span class="s">"10267617e7919a09a12"</span><span class="p">,</span>
    <span class="s">"security_token"</span><span class="p">:</span><span class="s">"c2a32524880"</span>
<span class="p">}</span>

<span class="n">src</span> <span class="o">=</span> <span class="s">"https://shopback.go2cloud.org/aff_c"</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>call order api when the conversion is made</p>
</blockquote>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th style="text-align: center">Type</th>
</tr>
</thead><tbody>
<tr>
<td>offer_id</td>
<td>Order API ID in ShopBack.</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>amount</td>
<td>Amount of the order has been made in NTD.</td>
<td style="text-align: center">Float</td>
</tr>
<tr>
<td>adv_sub</td>
<td>Order ID of the order has been made.</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub2 (optional)</td>
<td>String that refer to specific tier set in ShopBack.(define by merchant)</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub3 (optional)</td>
<td>SKU of the order has been made</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub4 (optional)</td>
<td>conversion_unique_id</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub5 (optional)</td>
<td></td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>security_token</td>
<td></td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>transaction_id</td>
<td>Hash value for ShopBack to identify each user and give cashback</br>(default to expire after postback)</td>
<td style="text-align: center">String</td>
</tr>
</tbody></table>

<h3 id='response-of-order-api'>Response Of Order API</h3>

<table><thead>
<tr>
<th>String</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>sucess=true;</td>
<td>Order has created successfully by API call.</td>
</tr>
<tr>
<td>success=false;</br>err_msg=Invalid Trans.</td>
<td>ID Transaction_id is in wrong format.</td>
</tr>
<tr>
<td>success=false;</br>err_msg=Request offer #1234 does not match session offer #2345.</td>
<td>This transaction_id wasn’t distributed by your offer.</td>
</tr>
<tr>
<td>success=false;</br>err_msg=Duplicate recorded with Trans. ID</td>
<td>This transaction_id has already expired.</td>
</tr>
</tbody></table>

<h3 id='error'>Error</h3>

<p>order</p>

<h2 id='validation-api'>Validation API</h2>

<p>When previous API was called, data will be created on ShopBack with parameter and “pending” status. Therefore, we need to use this API to override data status when order has been validated.</p>

<h3 id='https-request-of-validation-api'>HTTPS Request Of Validation API</h3>

<p><code>GET https://shopback.go2cloud.org/aff_lsr</code></p>

<blockquote>
<p>step 3 </p>
</blockquote>

<pre class="highlight shell tab-shell"><code><span class="c">#approved</span>
curl -X GET <span class="s2">"https://shopback.go2cloud.org/aff_lsr"</span><span class="se">\</span>
-d <span class="o">{</span><span class="s2">"offer_id"</span>:<span class="s2">"2118"</span>,<span class="se">\</span>
    <span class="s2">"aff_id"</span>:<span class="s2">"1152"</span>,<span class="se">\</span>
    <span class="s2">"adv_sub"</span>:<span class="s2">"A0149"</span>,<span class="se">\</span>
    <span class="s2">"amount"</span>:70,<span class="se">\</span>
    <span class="s2">"status"</span>:<span class="s2">"approved"</span>,<span class="se">\</span>
    <span class="s2">"security_token"</span>:<span class="s2">"c2a32524880"</span><span class="o">}</span>

<span class="c">#rejected</span>
curl -X GET <span class="s2">"https://shopback.go2cloud.org/aff_lsr"</span><span class="se">\</span>
-d <span class="o">{</span><span class="s2">"offer_id"</span>:<span class="s2">"2118"</span>,<span class="se">\</span>
    <span class="s2">"aff_id"</span>:<span class="s2">"1152"</span>,<span class="se">\</span>
    <span class="s2">"adv_sub"</span>:<span class="s2">"A0188"</span>,<span class="se">\</span>
    <span class="s2">"amount"</span>:130,<span class="se">\</span>
    <span class="s2">"status"</span>:<span class="s2">"rejected"</span>,<span class="se">\</span>
    <span class="s2">"security_token"</span>:<span class="s2">"c2a32524880"</span><span class="o">}</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// approved</span>
<span class="kd">var</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"aff_id"</span><span class="p">:</span><span class="s2">"1152"</span><span class="p">,</span> <span class="s2">"adv_sub"</span><span class="p">:</span><span class="s2">"A0149"</span><span class="p">,</span>
            <span class="s2">"amount"</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> <span class="s2">"status"</span><span class="p">:</span><span class="s2">"approved"</span><span class="p">,</span>
            <span class="s2">"security_token"</span><span class="p">:</span><span class="s2">"c2a32524880"</span><span class="p">};</span>
<span class="c1">// rejected</span>
<span class="kd">var</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"aff_id"</span><span class="p">:</span><span class="s2">"1152"</span><span class="p">,</span> <span class="s2">"adv_sub"</span><span class="p">:</span><span class="s2">"A0188"</span><span class="p">,</span>
            <span class="s2">"amount"</span><span class="p">:</span><span class="mi">130</span><span class="p">,</span> <span class="s2">"status"</span><span class="p">:</span><span class="s2">"rejected"</span><span class="p">,</span>
            <span class="s2">"security_token"</span><span class="p">:</span><span class="s2">"c2a32524880"</span><span class="p">};</span>
<span class="c1">// send request</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="s2">"https://shopback.go2cloud.org/aff_c?offer_id=2118"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">keys</span><span class="p">)</span>
    <span class="nx">src</span> <span class="o">+=</span> <span class="s1">'&amp;'</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'='</span> <span class="o">+</span> <span class="nx">param</span><span class="p">[</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
<span class="nx">requests</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">requests</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
</code></pre><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="c"># approved</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"offer_id"</span><span class="p">:</span><span class="s">"2118"</span><span class="p">,</span> <span class="s">"aff_id"</span><span class="p">:</span><span class="s">"1152"</span><span class="p">,</span> <span class="s">"adv_sub"</span><span class="p">:</span><span class="s">"A0149"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> <span class="s">"status"</span><span class="p">:</span><span class="s">"approved"</span><span class="p">,</span>
    <span class="s">"security_token"</span><span class="p">:</span><span class="s">"c2a32524880"</span>
<span class="p">}</span>
<span class="c"># rejected</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"offer_id"</span><span class="p">:</span><span class="s">"2118"</span><span class="p">,</span> <span class="s">"aff_id"</span><span class="p">:</span><span class="s">"1152"</span><span class="p">,</span> <span class="s">"adv_sub"</span><span class="p">:</span><span class="s">"A0188"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span><span class="mi">130</span><span class="p">,</span> <span class="s">"status"</span><span class="p">:</span><span class="s">"rejected"</span><span class="p">,</span>
    <span class="s">"security_token"</span><span class="p">:</span><span class="s">"c2a32524880"</span>
<span class="p">}</span>
<span class="c"># send request</span>
<span class="n">src</span> <span class="o">=</span> <span class="s">"https://shopback.go2cloud.org/aff_c"</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>call validation api when the status of this conversion has been updated.</p>
</blockquote>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th style="text-align: center">Type</th>
</tr>
</thead><tbody>
<tr>
<td>offer_id</td>
<td>Validation API ID in ShopBack.</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>aff_id</td>
<td>ShopBack Taiwan Code(fixed) : 1152</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>amount</td>
<td>Amount of the order has been madein NTD.</td>
<td style="text-align: center">Float</td>
</tr>
<tr>
<td>adv_sub</td>
<td>Order ID of the order has been made.</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub2 (optional)</td>
<td>String that refer to specific tier set in ShopBack.(define by merchant)</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub3 (optional)</td>
<td>SKU of the order has been made</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub4 (optional)</td>
<td>conversion_unique_id</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub5 (optional)</td>
<td></td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>security_token</td>
<td></td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>status</td>
<td>Final validated status on merchant site</td>
<td style="text-align: center">String</td>
</tr>
</tbody></table>

<h3 id='response-of-validation-api'>Response Of Validation API</h3>

<table><thead>
<tr>
<th>String</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>sucess=true;</td>
<td>Order has been updated into approved.</td>
</tr>
<tr>
<td>success=false;</td>
<td>Order has been updated into rejected.</td>
</tr>
</tbody></table>

<h3 id='note'>Note</h3>

<ol>
<li>Each API has its own offer_id, which won’t be the same.</li>
<li>Please make sure the OrderID of <strong>Order</strong> and <strong>Validation API</strong> stay the same.</li>
<li>The parameter of <strong>Validation API</strong> will be regarded as confirmed information, which will be used as reference of invoice amount.</li>
<li>Once the status is updated by <strong>Validation API</strong>, it cannot be reversed.</li>
<li>Notice that every response without additional notes means success. Please <strong>DO NOT</strong> make duplicated call and make sure that there’s only one call for each meaningfulorder information.</li>
</ol>

<h3 id='error'>Error</h3>

<p>validation</p>

<p><h1 id='pixel-implement'>Pixel Implement</h1><pre class="highlight shell tab-shell"><code><span class="c"># 請見 javascript</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kd">function</span> <span class="nx">ShopBackCookieSave</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">ssCalculateExpireDate</span><span class="p">(</span><span class="nx">days</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">setTime</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="nx">days</span> <span class="o"><em></span> <span class="mi">24</span> <span class="o"></em></span> <span class="mi">60</span> <span class="o"><em></span> <span class="mi">60</span> <span class="o"></em></span> <span class="mi">1000</span><span class="p">));</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">toUTCString</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">getParams</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;[?&amp;]&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;=([^&amp;]*)&quot;</span><span class="p">)).</span><span class="nx">exec</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">getParams</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nx">getParams</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;expires= &quot;</span> <span class="o">+</span> <span class="nx">ssCalculateExpireDate</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;; path=/&quot;</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;save &quot;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;cookie successfully&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this url doesnt contain&quot;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;parameter.&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c"># 請見 javascript</span>
</code></pre><h3 id='referral-handle'>Referral Handle</h3>
<p>content</p></p>

<p>content</p>

<p>content</p>

<p>content</p>

<aside class="notice"></br></br></br></br></aside>

<p>content</p>

<p>content</p>

<p><h3 id='conversion-handle'>Conversion Handle</h3><pre class="highlight javascript tab-javascript"><code><span class="cm">/**
 * securityToken, offerId, orderId and amount are necessary
 * The others are optional parameters 
 */</span>
<span class="kd">var</span> <span class="nx">securityToken</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">createPix</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">getCookie</span><span class="p">(</span><span class="s2">&quot;utm_source&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;shopback&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">offerId</span><span class="p">,</span> <span class="nx">orderId</span><span class="p">;</span> 
    <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;productId&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;tier&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;productId&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;tier&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">}];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// concatenate parameters after API call url</span>
      <span class="kd">var</span> <span class="nx">productId</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s2">&quot;productId&quot;</span><span class="p">],</span> <span class="nx">tier</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s2">&quot;tier&quot;</span><span class="p">];</span> 
      <span class="kd">var</span> <span class="nx">conversionUniqueId</span> <span class="o">=</span> <span class="nx">offerId</span> <span class="o">+</span> <span class="s1">&#39;<em>&#39;</span> <span class="o">+</span> <span class="nx">orderId</span> <span class="o">+</span> <span class="s1">&#39;</em>&#39;</span> <span class="o">+</span> <span class="nx">productId</span><span class="p">;</span> 
      <span class="kd">var</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s2">&quot;price&quot;</span><span class="p">];</span> 
      <span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;https://shopback.go2cloud.org/aff_l?offer_id=&quot;</span> <span class="o">+</span> <span class="nx">offerId</span> <span class="o">+</span> <span class="s2">&quot;&amp;adv_sub=&quot;</span> <span class="o">+</span> 
      <span class="nx">orderId</span> <span class="o">+</span> <span class="s2">&quot;&amp;adv_sub2=&quot;</span> <span class="o">+</span> <span class="nx">tier</span> <span class="o">+</span> <span class="s2">&quot;&amp;adv_sub3=&quot;</span> <span class="o">+</span> <span class="nx">productId</span> <span class="o">+</span> <span class="s2">&quot;&amp;adv_sub4=&quot;</span> <span class="o">+</span>
      <span class="nx">conversionUniqueId</span> <span class="o">+</span> <span class="s2">&quot;&amp;amount=&quot;</span> <span class="o">+</span> <span class="nx">amount</span> <span class="o">+</span> <span class="s2">&quot;&amp;security_token=&quot;</span> <span class="o">+</span> <span class="nx">securityToken</span><span class="p">;</span>
      <span class="c1">// create pixel </span>
      <span class="kd">var</span> <span class="nx">pix</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
      <span class="nx">pix</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">);</span>
      <span class="nx">pix</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">);</span>
      <span class="nx">pix</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">src</span><span class="p">));</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">pix</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></p>

<p><span class="kd">function</span> <span class="nx">getCookie</span><span class="p">(</span><span class="nx">cname</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">cname</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">ca</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ca</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">ca</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">trim</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p></br>
<iframe id="jsemb" src="https://stackblitz.com/edit/js-ye3mfy?embed=1&file=index.html&hidedevtools=0&devtoolsheight=60"></iframe></p></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="javascript">javascript</a>
                <a href="#" data-language-name="python">python</a>
          </div>
      </div>
    </div>
  </body>
</html>
