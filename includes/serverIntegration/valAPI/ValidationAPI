<h2 id='validation-api'>Validation API</h2>
<p>When previous API was called, data will be created on ShopBack with parameter and “pending” status. Therefore, we need to use this API to override data status when order has been validated.</p>
<h3 id='https-request-of-validation-api'>HTTPS Request Of Validation API</h3>
<p><code>GET https://shopback.go2cloud.org/aff_lsr</code></p>

<blockquote>
<p>step 3 </p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="c">#approved</span>
curl -X GET <span class="s2">"https://shopback.go2cloud.org/aff_lsr"</span><span class="se">\</span>
-d <span class="o">{</span><span class="s2">"offer_id"</span>:<span class="s2">"2118"</span>,<span class="se">\</span>
    <span class="s2">"aff_id"</span>:<span class="s2">"1152"</span>,<span class="se">\</span>
    <span class="s2">"adv_sub"</span>:<span class="s2">"A0149"</span>,<span class="se">\</span>
    <span class="s2">"amount"</span>:70,<span class="se">\</span>
    <span class="s2">"status"</span>:<span class="s2">"approved"</span>,<span class="se">\</span>
    <span class="s2">"security_token"</span>:<span class="s2">"c2a32524880"</span><span class="o">}</span>

<span class="c">#rejected</span>
curl -X GET <span class="s2">"https://shopback.go2cloud.org/aff_lsr"</span><span class="se">\</span>
-d <span class="o">{</span><span class="s2">"offer_id"</span>:<span class="s2">"2118"</span>,<span class="se">\</span>
    <span class="s2">"aff_id"</span>:<span class="s2">"1152"</span>,<span class="se">\</span>
    <span class="s2">"adv_sub"</span>:<span class="s2">"A0188"</span>,<span class="se">\</span>
    <span class="s2">"amount"</span>:130,<span class="se">\</span>
    <span class="s2">"status"</span>:<span class="s2">"rejected"</span>,<span class="se">\</span>
    <span class="s2">"security_token"</span>:<span class="s2">"c2a32524880"</span><span class="o">}</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// approved</span>
<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s2">"aff_id"</span><span class="p">:</span><span class="s2">"1152"</span><span class="p">,</span> <span class="s2">"adv_sub"</span><span class="p">:</span><span class="s2">"A0149"</span><span class="p">,</span>
    <span class="s2">"amount"</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> <span class="s2">"status"</span><span class="p">:</span><span class="s2">"approved"</span><span class="p">,</span>
    <span class="s2">"security_token"</span><span class="p">:</span><span class="s2">"c2a32524880"</span>
<span class="p">},</span>
<span class="c1">// rejected</span>
<span class="p">{</span>
    <span class="s2">"aff_id"</span><span class="p">:</span><span class="s2">"1152"</span><span class="p">,</span> <span class="s2">"adv_sub"</span><span class="p">:</span><span class="s2">"A0188"</span><span class="p">,</span>
    <span class="s2">"amount"</span><span class="p">:</span><span class="mi">130</span><span class="p">,</span> <span class="s2">"status"</span><span class="p">:</span><span class="s2">"rejected"</span><span class="p">,</span>
    <span class="s2">"security_token"</span><span class="p">:</span><span class="s2">"c2a32524880"</span>
<span class="p">}];</span>
<span class="c1">// send request</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">params</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="s2">"https://shopback.go2cloud.org/aff_c?offer_id=2118"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">keys</span><span class="p">)</span>
        <span class="nx">src</span> <span class="o">+=</span> <span class="s1">'&amp;'</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'='</span> <span class="o">+</span> <span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">keys</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
    <span class="nx">requests</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">requests</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="c"># approved</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s">"offer_id"</span><span class="p">:</span><span class="s">"2118"</span><span class="p">,</span> <span class="s">"aff_id"</span><span class="p">:</span><span class="s">"1152"</span><span class="p">,</span> <span class="s">"adv_sub"</span><span class="p">:</span><span class="s">"A0149"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> <span class="s">"status"</span><span class="p">:</span><span class="s">"approved"</span><span class="p">,</span>
    <span class="s">"security_token"</span><span class="p">:</span><span class="s">"c2a32524880"</span>
<span class="p">},</span>
<span class="c"># rejected</span>
<span class="p">{</span>
    <span class="s">"offer_id"</span><span class="p">:</span><span class="s">"2118"</span><span class="p">,</span> <span class="s">"aff_id"</span><span class="p">:</span><span class="s">"1152"</span><span class="p">,</span> <span class="s">"adv_sub"</span><span class="p">:</span><span class="s">"A0188"</span><span class="p">,</span>
    <span class="s">"amount"</span><span class="p">:</span><span class="mi">130</span><span class="p">,</span> <span class="s">"status"</span><span class="p">:</span><span class="s">"rejected"</span><span class="p">,</span>
    <span class="s">"security_token"</span><span class="p">:</span><span class="s">"c2a32524880"</span>
<span class="p">}]</span>
<span class="c"># send request</span>
<span class="n">src</span> <span class="o">=</span> <span class="s">"https://shopback.go2cloud.org/aff_c"</span>
<span class="k">for</span> <span class="n">itemParam</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">itemParam</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>call validation api when the status of this conversion has been updated.</p>
</blockquote>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th style="text-align: center">Type</th>
</tr>
</thead><tbody>
<tr>
<td>offer_id</td>
<td>Validation API ID in ShopBack.</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>aff_id</td>
<td>ShopBack Taiwan Code(fixed) : 1152</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>amount</td>
<td>Amount of the order has been madein NTD.</td>
<td style="text-align: center">Float</td>
</tr>
<tr>
<td>adv_sub</td>
<td>Order ID of the order has been made.</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub2 (optional)</td>
<td>String that refer to specific tier set in ShopBack.(define by merchant)</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub3 (optional)</td>
<td>SKU of the order has been made</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub4 (optional)</td>
<td>conversion_unique_id</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>adv_sub5 (optional)</td>
<td>Product name</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>conversion_unique_id</td>
<td>Unique key that concatenated by {merchant_name}_{order_id}</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>security_token</td>
<td>Hash key provided by shopback for postback</td>
<td style="text-align: center">String</td>
</tr>
<tr>
<td>status</td>
<td>Final validated status on merchant site</td>
<td style="text-align: center">String</td>
</tr>
</tbody></table>
<h3 id='response-of-validation-api'>Response Of Validation API</h3>
<table><thead>
<tr>
<th>String</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>sucess=true;</td>
<td>Order has been updated into approved.</td>
</tr>
</tbody></table>
<h3 id='note'>Note</h3>
<ol>
<li>Each API has its own offer_id, which won’t be the same.</li>
<li>Please make sure the OrderID of <strong>Order</strong> and <strong>Validation API</strong> stay the same.</li>
<li>The parameter of <strong>Validation API</strong> will be regarded as confirmed information, which will be used as reference of invoice amount.</li>
<li>Once the status is updated by <strong>Validation API</strong>, it cannot be reversed.</li>
<li>Notice that every response without additional notes means success. Please <strong>DO NOT</strong> make duplicated call and make sure that there’s only one call for each meaningfulorder information.</li>
</ol>

<h3 id='error'>Error</h3>

<table><thead>
<tr>
<th>String</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>success=false;</td>
<td>Order has been updated into rejected.</td>
</tr>
</tbody></table>
